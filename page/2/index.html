<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kubpang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="柯竹">
<meta property="og:url" content="https://kubpang.github.io/myBlog/page/2/index.html">
<meta property="og:site_name" content="柯竹">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="那个猪">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kubpang.github.io/myBlog/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>柯竹</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">柯竹</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/23/oyr/Nginx/Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/23/oyr/Nginx/Nginx/" class="post-title-link" itemprop="url">Nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-23 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-23T00:00:00+08:00">2021-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-12 18:31:44" itemprop="dateModified" datetime="2021-07-12T18:31:44+08:00">2021-07-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/22/oyr/MQ/RabbitMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/22/oyr/MQ/RabbitMQ/" class="post-title-link" itemprop="url">RabbitMQ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-22T00:00:00+08:00">2021-06-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-13 18:38:41" itemprop="dateModified" datetime="2021-07-13T18:38:41+08:00">2021-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-MQ/" itemprop="url" rel="index"><span itemprop="name">oyr-MQ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RabbitMQ下载与安装"><a href="#RabbitMQ下载与安装" class="headerlink" title="RabbitMQ下载与安装"></a>RabbitMQ下载与安装</h1><h2 id="Linux下安装"><a href="#Linux下安装" class="headerlink" title="Linux下安装"></a>Linux下安装</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>环境相关：<br>linux（CentOS 7.5）<br>erlang 22.x<br>rabbitmq 3.7.18</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/22/oyr/MQ/RabbitMQ/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/22/oyr/MySQL/MySQL-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/22/oyr/MySQL/MySQL-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">MySQL-日志系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-22T00:00:00+08:00">2021-06-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-13 17:50:05" itemprop="dateModified" datetime="2021-07-13T17:50:05+08:00">2021-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-MySQL/" itemprop="url" rel="index"><span itemprop="name">oyr-MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL日志分类"><a href="#MySQL日志分类" class="headerlink" title="MySQL日志分类"></a>MySQL日志分类</h1><p>注意：<br>设置系统参数方式修改，需要重新连接一个会话，如mysql重启即失效，如果要永久存在则需要修改配置文件。<br>如果想要当前会话生效通过set sesison进行设置。</p>
<h2 id="日志分类"><a href="#日志分类" class="headerlink" title="日志分类"></a>日志分类</h2><p>Mysql有7种日志文件，分别是：<br>1）errorlog（错误日志）<br>2）generallog（普通日志）<br>3）slow query log（慢查询日志）<br>4）binlog（二进制日志）<br>5）relaylog（中继日志）<br>6）redolog（重做日志）<br>7）undolog（回滚日志）</p>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/22/oyr/MySQL/MySQL-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/21/oyr/MQ/AMQP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/21/oyr/MQ/AMQP/" class="post-title-link" itemprop="url">AMQP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-21T00:00:00+08:00">2021-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-09 15:12:53" itemprop="dateModified" datetime="2021-07-09T15:12:53+08:00">2021-07-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-MQ/" itemprop="url" rel="index"><span itemprop="name">oyr-MQ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="AMQP是什么"><a href="#AMQP是什么" class="headerlink" title="AMQP是什么"></a>AMQP是什么</h1><p>AMQP（Advanced Message Queuing Protocol，高级消息队列协议）是一个进程间传递异步消息的网络协议。</p>
<p>在异步通讯中，消息不会立刻到达接收方，而是被存放到一个容器中，当满足一定的条件之后，消息会被容器发送给接收方，这个容器即消息队列，而完成这个功能需要双方和容器以及其中的各个组件遵守统一的约定和规则，AMQP就是这样的一种协议，消息发送与接受的双方遵守这个协议可以实现异步通讯。这个协议约定了消息的格式和工作方式。</p>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/21/oyr/MQ/AMQP/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/21/oyr/Redis/Redis-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/21/oyr/Redis/Redis-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">Redis-数据过期策略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-21T00:00:00+08:00">2021-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-13 17:52:39" itemprop="dateModified" datetime="2021-07-13T17:52:39+08:00">2021-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-Redis/" itemprop="url" rel="index"><span itemprop="name">oyr-Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前提补充"><a href="#前提补充" class="headerlink" title="前提补充"></a>前提补充</h1><p>我们讲过期策略之前，我们先来看几个问题，后面学习的时候带着这几个问题去学习。</p>
<h2 id="我往redis里写的数据怎么没了？"><a href="#我往redis里写的数据怎么没了？" class="headerlink" title="我往redis里写的数据怎么没了？"></a>我往redis里写的数据怎么没了？</h2><p>我相信大家在使用redis的时候，都会遇到redis经常丢掉一些数据，写进去了，过一会儿可能就没了。那么这个问题我们需要反思一下：redis是缓存，你给当存储了是吧？</p>
<p>什么是缓存？用内存当缓存。内存是无限的吗，内存是很宝贵而且是有限的，磁盘是廉价而且是大量的。可能一台机器就几十个G的内存，但是可以有几个T的硬盘空间。redis主要是基于内存来进行高性能、高并发的读写操作的。</p>
<p>那既然内存是有限的，比如redis就只能用10个G，你要是往里面写了20个G的数据，会咋办？当然会干掉10个G的数据，然后就保留10个G的数据了。那干掉哪些数据？保留哪些数据？当然是干掉不常用的数据，保留常用的数据了。</p>
<p>所以说，这是缓存的一个最基本的概念，数据是会过期的，要么是你自己设置个过期时间，要么是redis自己给干掉了。</p>
<p>set key value 过期时间（1小时）<br>set进去的key，1小时之后就没了，就失效了</p>
<h2 id="我的数据明明都过期了，怎么还占用着内存啊？"><a href="#我的数据明明都过期了，怎么还占用着内存啊？" class="headerlink" title="我的数据明明都过期了，怎么还占用着内存啊？"></a>我的数据明明都过期了，怎么还占用着内存啊？</h2><p>还有一种就是如果你设置好了一个过期时间，你知道redis是怎么给你弄成过期的吗？什么时候删除掉？如果你不知道，那么你就需要思考，为啥好多数据明明应该过期了，结果发现redis内存占用还是很高？那是因为你不知道redis是怎么删除那些过期key的。</p>
<p>redis内存一共是10g，你现在往里面写了5g的数据，结果这些数据明明你都设置了过期时间，要求这些数据1小时之后都会过期，结果1小时之后，你回来一看，redis机器，怎么内存占用还是50%呢？5g数据过期了，我从redis里查，是查不到了，结果过期的数据还占用着redis的内存。</p>
<p>如果你连这个问题都不知道，上来就懵了，回答不出来，那线上你写代码的时候，想当然的认为写进redis的数据就一定会存在，后面导致系统各种漏洞和bug，谁来负责？</p>
<h1 id="对key设置过期时间"><a href="#对key设置过期时间" class="headerlink" title="对key设置过期时间"></a>对key设置过期时间</h1><p>expire key time(以秒为单位)–这是最常用的方式</p>
<p>Redis对存储值的过期处理实际上是针对该值的键（key）处理的，即时间的设置也是设置key的有效时间。<br>Expires字典保存了所有键的过期时间，Expires也被称为过期字段。</p>
<p>注意：<br>1、除了字符串自己独有设置过期时间的方法外，其他方法都需要依靠expire方法来设置时间<br>2、如果没有设置时间，那缓存就是永不过期<br>3、如果设置了过期时间，之后又想让缓存永不过期，使用persist key</p>
<h1 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h1><h2 id="三种过期策略机制"><a href="#三种过期策略机制" class="headerlink" title="三种过期策略机制"></a>三种过期策略机制</h2><p>1）定时删除（没人用）<br>含义：在设置key的过期时间的同时，为该key创建一个定时器，让定时器在key的过期时间来临时，对key进行删除。</p>
<p>优点：可以保证内存被尽快释放</p>
<p>缺点：若过期key很多，删除这些key会占用很多的CPU时间，在CPU时间紧张的情况下，CPU不能把所有的时间用来做要紧的事儿，还需要去花时间删除这些key</p>
<p>2）惰性删除<br>含义：key过期的时候不删除，每次从redis获取key的时候去检查是否过期，若过期，则删除，返回null。</p>
<p>优点：删除操作只发生在从数据库取出key的时候发生，而且只删除当前key，所以对CPU时间的占用是比较少的，而且此时的删除是已经到了非做不可的地步（如果此时还不删除的话，我们就会获取到了已经过期的key了）</p>
<p>缺点：若大量的key在超出超时时间后，很久一段时间内，都没有被获取过，那么可能发生内存泄露（无用的垃圾占用了大量的内存）</p>
<p>3）定期删除<br>含义：所谓定期删除，指的是redis默认是每隔100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。</p>
<p>优点：通过限制删除操作的时长和频率，来减少删除操作对CPU时间的占用–处理”定时删除”的缺点</p>
<p>缺点：<br>在内存友好方面，不如”定时删除”<br>在CPU时间友好方面，不如”惰性删除”</p>
<p><strong>定期删除过期key可以处理”惰性删除”的缺点</strong></p>
<h2 id="三种过期策略机制总结"><a href="#三种过期策略机制总结" class="headerlink" title="三种过期策略机制总结"></a>三种过期策略机制总结</h2><p>看完上面三种策略后可以得出以下结论：<br>定时删除和定期删除为主动删除：Redis会定期主动淘汰一批已过去的key<br>惰性删除为被动删除：用到的时候才会去检验key是不是已过期，过期就删除。</p>
<p>定期删除可以通过：<br>第一、配置redis.conf的hz选项，默认为10 （即1秒执行10次，100ms一次，值越大说明刷新频率越快，最Redis性能损耗也越大） <br>第二、配置redis.conf的maxmemory最大值，当已用内存超过maxmemory限定时，就会触发主动清理策略</p>
<h1 id="Redis默认采用的过期策略"><a href="#Redis默认采用的过期策略" class="headerlink" title="Redis默认采用的过期策略"></a>Redis默认采用的过期策略</h1><p>Redis服务器默认过期内置策略是：惰性删除+定期删除</p>
<p>惰性删除流程：<br>在进行get或setnx等操作时，先检查key是否过期；<br>若过期，删除key，然后执行相应操作；<br>若没过期，直接执行相应操作。  </p>
<p>定期删除流程：<br>（简单而言，对指定个数个库的每一个库随机删除小于等于指定个数个过期key）<br>遍历每个数据库（就是redis.conf中配置的”database”数量，默认为16）<br>检查当前库中的指定个数个key（默认是每个库检查20个key，注意相当于该循环执行20次，循环体时下边的描述）<br>如果当前库中没有一个key设置了过期时间，直接执行下一个库的遍历。<br>随机获取一个设置了过期时间的key，检查该key是否过期，如果过期，删除key。<br>判断定期删除操作是否已经达到指定时长，若已经达到，直接退出定期删除。</p>
<p>提问：为什么不使用定时删除，而使用定期删除呢？<br>所谓定期删除，指的是redis默认是每隔100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。假设redis里放了10万个key，都设置了过期时间，你每隔几百毫秒，就检查10万个key，那redis基本上就死了，cpu负载会很高的，消耗在你的检查过期key上了。注意，这里可不是每隔100ms就遍历所有的设置过期时间的key，那样就是一场性能上的灾难。实际上redis是每隔100ms随机抽取一些key来检查和删除的。</p>
<h1 id="持久化机制对过期key的处理"><a href="#持久化机制对过期key的处理" class="headerlink" title="持久化机制对过期key的处理"></a>持久化机制对过期key的处理</h1><h2 id="RDB对过期key的处理"><a href="#RDB对过期key的处理" class="headerlink" title="RDB对过期key的处理"></a>RDB对过期key的处理</h2><p>过期key对RDB没有任何影响<br>从内存数据库持久化数据到RDB文件<br>持久化key之前，会检查是否过期，过期的key不进入RDB文件<br>从RDB文件恢复数据到内存数据库<br>数据载入数据库之前，会对key先进行过期检查，如果过期，不导入数据库（主库情况）</p>
<h2 id="AOF对过期key的处理"><a href="#AOF对过期key的处理" class="headerlink" title="AOF对过期key的处理"></a>AOF对过期key的处理</h2><p>过期key对AOF没有任何影响<br>从内存数据库持久化数据到AOF文件：<br>当key过期后，还没有被删除，此时进行执行持久化操作（该key是不会进入aof文件的，因为没有发生修改命令）<br>当key过期后，在发生删除操作时，程序会向aof文件追加一条del命令（在将来的以aof文件恢复数据的时候该过期的键就会被删掉）<br>AOF重写<br>重写时，会先判断key是否过期，已过期的key不会重写到aof文件</p>
<h1 id="内存淘汰机制"><a href="#内存淘汰机制" class="headerlink" title="内存淘汰机制"></a>内存淘汰机制</h1><h2 id="内存淘汰引入"><a href="#内存淘汰引入" class="headerlink" title="内存淘汰引入"></a>内存淘汰引入</h2><p>想一想，redis服务器默认过期内置策略是：惰性删除+定期删除。</p>
<p>所谓定期删除，指的是redis默认是每隔100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。假设redis里放了10万个key，都设置了过期时间，你每隔几百毫秒，就检查10万个key，那redis基本上就死了，cpu负载会很高的，消耗在你的检查过期key上了。注意，这里可不是每隔100ms就遍历所有的设置过期时间的key，那样就是一场性能上的灾难。实际上redis是每隔100ms随机抽取一些key来检查和删除的。</p>
<p>但是问题是，定期删除可能会导致很多过期key到了时间并没有被删除掉，那咋整呢？所以就是惰性删除了。这就是说，在你获取某个key的时候，redis会检查一下 ，这个key如果设置了过期时间那么是否过期了？如果过期了此时就会删除，不会给你返回任何东西。<br>并不是key到时间就被删除掉，而是你查询这个key的时候，redis再懒惰的检查一下。<br>通过上述两种手段结合起来，保证过期的key一定会被干掉。</p>
<p>很简单，就是说，你的过期key，靠定期删除没有被删除掉，还停留在内存里，占用着你的内存呢，除非你的系统去查一下那个key，才会被redis给删除掉。</p>
<p>但是实际上这还是有问题的，如果定期删除漏掉了很多过期key，然后你也没及时去查，也就没走惰性删除，此时会怎么样？<br>如果大量过期key堆积在内存里，导致redis内存块耗尽了，咋整？</p>
<p><strong>答案是：走内存淘汰机制。</strong></p>
<h2 id="内存淘汰机制-1"><a href="#内存淘汰机制-1" class="headerlink" title="内存淘汰机制"></a>内存淘汰机制</h2><p>如果redis的内存占用过多的时候，此时会进行内存淘汰，有如下一些策略：<br>redis 10个key，现在已经满了，redis需要删除掉5个key<br>1个key，最近1分钟被查询了100次<br>1个key，最近10分钟被查询了50次<br>1个key，最近1个小时倍查询了1次</p>
<p>1）noeviction：当内存不足以容纳新写入数据时，新写入操作会报错，这个一般没人用吧，实在是太恶心了<br>2）allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key（这个是最常用的）<br>3）allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key，这个一般没人用吧，为啥要随机，肯定是把最近最少使用的key给干掉啊<br>4）volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key（这个一般不太合适）<br>5）volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key<br>6）volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/20/oyr/Feign/Feign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/20/oyr/Feign/Feign/" class="post-title-link" itemprop="url">Feign</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-20T00:00:00+08:00">2021-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-12 18:31:44" itemprop="dateModified" datetime="2021-07-12T18:31:44+08:00">2021-07-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HTTP-%E5%AE%A2%E6%88%B7%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">HTTP 客户端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Feign使得 Java HTTP 客户端编写更方便。Feign 灵感来源于Retrofit、JAXRS-2.0和WebSocket。<br>Feign最初是为了降低统一绑定Denominator到HTTP API的复杂度，不区分是否支持Restful。<br>Feign旨在通过最少的资源和代码来实现和HTTP API的连接。通过可定制的解码器和错误处理，可以编写任意的HTTP API。</p>
<h2 id="为什么选择Feign"><a href="#为什么选择Feign" class="headerlink" title="为什么选择Feign?"></a>为什么选择Feign?</h2><p>你可以使用 Jersey 和 CXF 这些来写一个 Rest 或 SOAP 服务的java客服端。<br>你也可以直接使用 Apache HttpClient 来实现。<br>但是 Feign 的目的是尽量的减少资源和代码来实现和 HTTP API 的连接。通过自定义的编码解码器以及错误处理，你可以编写任何基于文本的 HTTP API。</p>
<h2 id="Feign工作机制"><a href="#Feign工作机制" class="headerlink" title="Feign工作机制"></a>Feign工作机制</h2><p>Feign通过注解注入一个模板化请求进行工作。只需在发送之前关闭它，参数就可以被直接的运用到模板中。<br>然而这也限制了Feign，只支持文本形式的API，它在响应请求等方面极大的简化了系统。同时，它也是十分容易进行单元测试的。</p>
<h2 id="版本兼容性"><a href="#版本兼容性" class="headerlink" title="版本兼容性"></a>版本兼容性</h2><p>Feign 10.x 及以上版本基于 Java 8 构建，应该适用于 Java 9、10 和 11。<br>对于需要兼容 JDK 6 的用户，请使用 Feign 9.x</p>
<h2 id="功能概述"><a href="#功能概述" class="headerlink" title="功能概述"></a>功能概述</h2><p>这是一张包含 feign 提供的当前关键功能的地图：<br><img src="https://rong0624.github.io/images/Feign/" alt="feign功能概述"></p>
<h1 id="Feign使用简介"><a href="#Feign使用简介" class="headerlink" title="Feign使用简介"></a>Feign使用简介</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/20/oyr/Hexo/Hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/20/oyr/Hexo/Hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Hexo常用命令.md</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-20T00:00:00+08:00">2021-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-12 18:31:44" itemprop="dateModified" datetime="2021-07-12T18:31:44+08:00">2021-07-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/20/oyr/Hexo/Hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/20/oyr/Java/Java8%E6%96%B0%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/20/oyr/Java/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">Java8新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-20T00:00:00+08:00">2021-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-13 17:36:34" itemprop="dateModified" datetime="2021-07-13T17:36:34+08:00">2021-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java8新特性简介"><a href="#Java8新特性简介" class="headerlink" title="Java8新特性简介"></a>Java8新特性简介</h1><p>1）速度更快<br>2）代码更少（增加了新的语法Lambda表达式）<br>3）强大的Stream API<br>4）便于并行<br>5）最大化减少空指针异常 Optional</p>
<p><strong>其中 Lambda 表达式与 Stream API 最为核心的。</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/20/oyr/Java/Java8%E6%96%B0%E7%89%B9%E6%80%A7/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/20/oyr/MQ/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%85%A5%E9%97%A8%E4%B8%8E%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/20/oyr/MQ/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%85%A5%E9%97%A8%E4%B8%8E%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">消息中间件入门与简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-20T00:00:00+08:00">2021-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-09 16:54:19" itemprop="dateModified" datetime="2021-07-09T16:54:19+08:00">2021-07-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-MQ/" itemprop="url" rel="index"><span itemprop="name">oyr-MQ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是中间件"><a href="#什么是中间件" class="headerlink" title="什么是中间件"></a>什么是中间件</h1><h2 id="什么是中间件-1"><a href="#什么是中间件-1" class="headerlink" title="什么是中间件"></a>什么是中间件</h2><p>我国企业从20世纪80年代开始就逐渐进行信息化建设，由于方法和体系的不成熟，以及企业业务的市场需求的不断变化，一个企业可能同时运行着多个不同的业务系统，这些系统可能基于不同的操作系统、不同的数据库、异构的网络环境。现在的问题是，如何把这些信息系统结合成一个有机地协同工作的整体，真正实现企业跨平台、分布式应用。中间件便是解决之道，它用自己的复杂换取了企业应用的简单。</p>
<p>中间件（Middleware）是处于操作系统和应用程序之间的软件，也有人认为它应该属于操作系统中的一部分。人们在使用中间件时，往往是一组中间件集成在一起，构成一个平台（包括开发平台和运行平台），但在这组中间件中必须要有一个通信中间件，即中间件+平台+通信，这个定义也限定了只有用于分布式系统中才能称为中间件，同时还可以把它与支撑软件和使用软件区分开来</p>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/20/oyr/MQ/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%85%A5%E9%97%A8%E4%B8%8E%E7%AE%80%E4%BB%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kubpang.github.io/myBlog/2021/06/20/oyr/MySQL/MySQL-%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="那个猪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯竹">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/20/oyr/MySQL/MySQL-%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">MySQL-基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-20T00:00:00+08:00">2021-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-13 17:52:43" itemprop="dateModified" datetime="2021-07-13T17:52:43+08:00">2021-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oyr-MySQL/" itemprop="url" rel="index"><span itemprop="name">oyr-MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Mysql数据库</p>
<h1 id="MySql基础"><a href="#MySql基础" class="headerlink" title="MySql基础"></a>MySql基础</h1><h2 id="数据库的好处"><a href="#数据库的好处" class="headerlink" title="数据库的好处"></a>数据库的好处</h2><p>可以持久化到本地<br>结构化查询</p>
<hr>
<h2 id="主流的数据库介绍（了解）"><a href="#主流的数据库介绍（了解）" class="headerlink" title="主流的数据库介绍（了解）"></a>主流的数据库介绍（了解）</h2><p>Sql server 数据库<br>是微软，.net程序员最爱，中型和大型项目，性能高</p>
<p>Oracle数据库<br>是甲骨文的，java程序员（必学），大型项目，特点是适合处理复杂业务逻辑。</p>
<p>Mysql数据库<br>是sun公司，属于甲骨文公司，中型大型项目，特点：并发性好。对简单的sql处理效率高。</p>
<p>db2数据库<br>是ibm公司，处理海量数据，大型项目。很强悍。</p>
<p>Informix数据库<br>是ibm公司。在银行系统，安全性高</p>
<p>Sybase数据库</p>
<hr>
<h2 id="mysql的优点"><a href="#mysql的优点" class="headerlink" title="mysql的优点"></a>mysql的优点</h2><p>开源，免费成本低<br>性能高，移植性也好<br>体积小，便于安装</p>
<h2 id="mysql数据库的安装和配置"><a href="#mysql数据库的安装和配置" class="headerlink" title="mysql数据库的安装和配置"></a>mysql数据库的安装和配置</h2><p>看MySQL-5.7.17安装与配置.docx</p>
<h2 id="mysql的基本使用"><a href="#mysql的基本使用" class="headerlink" title="mysql的基本使用"></a>mysql的基本使用</h2><p>（1）连接到mysql<br>Cmd&gt;mysql -h 主机名 -u 用户名 -p 密码 回车<br>举例：</p>
<p>说明：<br>如果你没有写-h localhost 默认是连接本地</p>
<p>如果你需要远程登录到另一个mysql,则需要修改配置。<br>一般情况下部让远程登录。</p>
<p>（2）sql服务的退出<br>exit或ctrl+c</p>
<p>（3）关闭和启动mysql服务<br>界面操作：</p>
<p>命令模式：<br>启动：net stop mysql<br>停止：net start mysql<br>举例：</p>
<p>说明：这里mysql不是固定的，是安装时取的服务名称。</p>
<h2 id="mysql数据库三层架构介绍"><a href="#mysql数据库三层架构介绍" class="headerlink" title="mysql数据库三层架构介绍"></a>mysql数据库三层架构介绍</h2><p>专业术语</p>
<p>Db：<br>数据库（database）存储数据的”仓库”。它保存了一系列有组织的数据。</p>
<p>Dbms：<br>数据库管理系统（database management system）。数据库是通过dbms创建和操作的容器。</p>
<p>Sql:<br>结构化查询语言（Structure Query Langeuage）：专门用来与数据库通信的语言。</p>
<p>数据库服务器，数据库和表的关系如图所示：</p>
<p>示意图：</p>
<h2 id="mysql常见命令"><a href="#mysql常见命令" class="headerlink" title="mysql常见命令"></a>mysql常见命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.查看当前所有的数据库</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">2.打开指定的库</span><br><span class="line">use 库名;</span><br><span class="line"></span><br><span class="line">3.查看所在的数据库名</span><br><span class="line">select database();</span><br><span class="line"></span><br><span class="line">4.查看当前库的所有表</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">5.查看其它库的所有表</span><br><span class="line">show tables from 库名;</span><br><span class="line"></span><br><span class="line">6.创建表</span><br><span class="line">create table user(id int, name varchar(20));</span><br><span class="line"></span><br><span class="line">7.查看表结构</span><br><span class="line">desc 表名;		</span><br><span class="line"></span><br><span class="line">8.查看服务器的版本</span><br><span class="line">方式一：登录到mysql服务端</span><br><span class="line">Select version();</span><br><span class="line">方式二：没有登录到mysql服务端</span><br><span class="line">Mysql --version或mysql --V</span><br><span class="line"></span><br><span class="line">9.查看当前时区</span><br><span class="line">SHOW VARIABLES LIKE &#x27;time_zone&#x27;</span><br><span class="line">SET time_zone=&#x27;+9:00&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="Mysql的语法规范"><a href="#Mysql的语法规范" class="headerlink" title="Mysql的语法规范"></a>Mysql的语法规范</h2><p>1.不区分大小写，单建议关键字大写，表名，列名小写。<br>2.每条语句最好用分号结尾。<br>3.每条命令根据需要，可以进行缩进或换行<br>4.注释<br>单行注释：两种<br>第一种：#注释文字<br>第二种：– 注释文字<br>多行注释：/* 注释文字 */</p>
<h1 id="常用数据类型"><a href="#常用数据类型" class="headerlink" title="常用数据类型"></a>常用数据类型</h1><h2 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h2><h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><p>特点：<br>1）如果不设置无符号还是有符号，默认是有符号，如果想设置无符号，需要添加unsigned关键字<br>2）如果插入的数值超出了整型范围，会报out of range异常，并且插入临界值<br>3）如果不设置长度，会有默认的长度，长度代表了显示的最大宽度，如果不够用0在左边填充，但必须搭配zerofill使用！</p>
<h3 id="小数"><a href="#小数" class="headerlink" title="小数"></a>小数</h3><p>浮点型：<br>Float(m, d)，double(m, d)<br>4            8</p>
<p>定点型：<br>Dec(m, d)，decimal(m, d)<br>M+2        m+2</p>
<p>特点：<br>（1）<br>M：整数部位+小数部位（总长度）<br>D：小数部位<br>如果超出范围插入临界值</p>
<p>（2）<br>M和D都可以省略<br>如果是decimal，则m默认为10，d默认为0<br>如果是double和float，则会随着插入的数值的精度来决定精度</p>
<p>（3）定点型的精确度较高，如果要求插入数值的精度较高，如：货币运算等则考虑使用</p>
<h2 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h2><p>较短的文本：<br>Char<br>Varchar</p>
<p>特点：</p>
<p>写法        m的意思            特点            空间的耗费        效率<br>Char    char(m)        最大的字符数    固定长度        比较耗费        高<br>Varchar    varchar(m)    最大的字符数    可变长度的字符    比较节省        低</p>
<p>较长的文本：<br>Text<br>Blob（较大的二进制）</p>
<p>Enum类型：<br>说明:又称为枚举类型哦，要求插入的值必须属于列表中指定的值之一。<br>如果列表成员为1<del>255，则需要1个字节存储<br>如果列表成员为255</del>65535，则需要2个字节存储<br>最多需要65535个成员</p>
<p>Set类型：<br>说明：和Enum类型类似，里面可以保存0~64个成员。和Enum类型最大的区<br>别是：SET类型一次可以选取多个成员，而Enum只能选一个<br>根据成员个数不同，存储所占的字节也不同</p>
<h2 id="日期型"><a href="#日期型" class="headerlink" title="日期型"></a>日期型</h2><p>总结：<br>Date：只保存日期，并没有保存到时分秒<br>Time：只保存时间（时分秒）<br>Year：只保存年</p>
<p>Datetime：保存日期+时间<br>Timestamp：保存日期+时间</p>
<p>Datetime VS Timestamp</p>
<p>字节    范围        时区等的影响<br>Datetime     8        1000-9999        不受<br>Timestamp    4        1970-2038        受</p>
<h1 id="DQL语言（select）"><a href="#DQL语言（select）" class="headerlink" title="DQL语言（select）"></a>DQL语言（select）</h1><h2 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>select 查询列表 from 表名</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>查询列表开源是字段，常量表达式，函数，也可以有多个。<br>查询结构是一个虚拟表。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>1.查询单个字段<br>Select 字段名 from 表名</p>
<p>2.查询多个字段<br>Select 字段名,字段名 from 表名</p>
<p>3.查询所有的字段<br>Select * from 表名</p>
<p>4.查询常量<br>Select 常量值<br>注意：字符型和日期型常量值必须用单引号用起来，数值类不需要</p>
<p>5.查询函数<br>Select 函数名（实例参数）;</p>
<p>6.查询表达式<br>Select 100*10;</p>
<p>7.取别名（两种方式）<br>As<br>Select last_name as 姓名 from 表名  </p>
<p>空格<br>Select last_name 姓名 from 表名</p>
<p>8.去重<br>Select distinct 字段名 from 表名</p>
<p>9.+<br>作用：加法运算<br>Select 数值+数值;直接运算<br>Select 字符+数值，先将字符转成数值，如果转换成功，则继续运算，否则转换成0，    再做运算。</p>
<p>10.补充Concat函数<br>功能：拼接字符<br>Select concat(字符1,字符2,字符3,….)</p>
<p>11.补充ifnull函数<br>Select ifnull(name, 0) from user</p>
<p>12.补充isnull函数<br>Select isnull(name) from user<br>功能：拍的某个字段是否为null，如果是返回1，如果不是返回0</p>
<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Select 查询列表  </span><br><span class="line">From 表名  </span><br><span class="line">Where 筛选条件</span><br></pre></td></tr></table></figure>

<h3 id="筛选条件的分类"><a href="#筛选条件的分类" class="headerlink" title="筛选条件的分类"></a>筛选条件的分类</h3><p>（1）简单条件运算符  </p>
<p><code>&gt; &lt; = &lt;&gt; != &gt;= &lt;= &lt;=&gt;</code></p>
<p>Select * from user where age&gt;15;</p>
<p>Select * from user where age&lt;15;</p>
<p>Select * from user where age&lt;&gt;15;</p>
<p>&lt;=&gt;:安全等于，可以判断普通数值，也可以判断是否为null<br>Select * from user where age&lt;=&gt; null;</p>
<p>（2）逻辑运算符</p>
<p><code>and or not</code></p>
<p>And:<br>SELECT last_name FROM employees WHERE salary&gt;=10000 AND salary&lt;=20000;</p>
<p>Or:<br>SELECT * FROM employees WHERE department_id&lt;90 OR department_id&gt;110 OR salary&gt;15000;</p>
<p>Not:<br>SELECT * FROM employees WHERE NOT(department_id&gt;=90 AND department_id&lt;=110) OR salary&gt;15000;</p>
<p>（3）模糊查询</p>
<p><code>Like, between and, in, is null, is not null </code></p>
<p>like：<br>Select * from user where name like’%a%’;<br>Select * from user where name like’_a%’;</p>
<p>between and:<br>作用：在哪两个数之间<br>Select * from user where age between 10 and 20;</p>
<p>in:<br>Select * from user where id in(1,2,3);</p>
<p>is null:<br>作用：判断是否为null<br>Select * from user where age is null;</p>
<p>is not null:<br>作用：判断是否不为空<br>Select * from user where age is not null;</p>
<h2 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p>Select * from 表名<br>[Where 筛选条件]<br>Order by 排序列表[asc desc]</p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><p>（1）asc代表升序，desc代表降序，如果不写是升序。<br>（2）order by子句可以支持单个字段，多个字段，表达式，函数，别名<br>（3）order by子句一般是放查询语句的最后面，limit子句除外</p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>#案例：查询员工信息，要求工资冲高到底排序  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>#案例：按年薪的高低显示员工的信息和年薪【按表达式排序】  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>, salary<span class="operator">*</span><span class="number">12</span><span class="operator">*</span>(<span class="number">1</span><span class="operator">+</span>IFNULL(commission_pct, <span class="number">0</span>)) <span class="keyword">AS</span> 年薪 </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>#案例：查询邮箱中包含e的员工信息，并先按邮箱的字节数降序，再按部门号升序 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%e%&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> LENGTH(email) <span class="keyword">DESC</span>, department_id <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<h2 id="常见函数"><a href="#常见函数" class="headerlink" title="常见函数"></a>常见函数</h2><p>功能：类似java中的方法<br>好处：提高重用性和隐藏实现细节<br>调用：select 函数名(参数列表)  </p>
<h3 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h3><p>LENGTH：<br>作用：获取参数的字节个数  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;oyr&#x27;</span>);  </span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;欧阳荣&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p>CONCAT：<br>作用：拼接字符串  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;jkl&#x27;</span>);  </span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(first_name, last_name) out_put <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>


<p>UPPER：<br>作用：字符串变大写  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(&quot;asc&quot;);</span><br></pre></td></tr></table></figure>

<p>Lower：<br>作用：字符串变小写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(&quot;ASC&quot;);</span><br></pre></td></tr></table></figure>

<p>Substr:<br>作用：截取字符串，两种使用方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#第一种：截取从指定索引处后面所有字符  </span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(&quot;欧阳荣真的帅哦&quot;, <span class="number">4</span>);  </span><br><span class="line">结果：真的帅哦</span><br><span class="line"></span><br><span class="line">#第二种：截取从指定索引处指定字符串的字符  </span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(&quot;欧阳荣不是一般帅哦&quot;, <span class="number">1</span>, <span class="number">3</span>);  </span><br><span class="line">结果：欧阳荣</span><br><span class="line"></span><br><span class="line"># 案例<span class="number">1</span>：姓名首字母大写，其他字符小写然后用_拼接，显示出来</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="built_in">UPPER</span>(SUBSTR(last_name, <span class="number">1</span>, <span class="number">1</span>)), <span class="string">&#x27;_&#x27;</span>, <span class="built_in">LOWER</span>(SUBSTR(last_name, <span class="number">2</span>))) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>Trim:<br>作用：去除两边空格或去除两边指定字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#去除两边空格：</span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="built_in">TRIM</span>(<span class="string">&#x27;   欧阳荣 &#x27;</span>));</span><br><span class="line">结果：欧阳荣</span><br><span class="line"></span><br><span class="line">#去除两边指定字符：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;a&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;aaaaaaaa欧阳aaa荣aaaaaa&#x27;</span>);</span><br><span class="line">结果：欧阳aaa荣</span><br></pre></td></tr></table></figure>

<p>Lpad：<br>作用：lpad 用指定的字符实现左填充指定长度  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;欧阳荣&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;a&#x27;</span>) out_put;</span><br></pre></td></tr></table></figure>

<p>Rpad：<br>作用：用指定的字符实现右填充指定长度  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;欧阳荣&#x27;</span>, <span class="number">12</span>, <span class="string">&#x27;ab&#x27;</span>) out_put;</span><br></pre></td></tr></table></figure>

<p>Replace：<br>作用：替换字符串  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;赵吊彬是zz赵吊彬赵吊彬赵吊彬&#x27;</span>, <span class="string">&#x27;赵吊彬&#x27;</span>, <span class="string">&#x27;李执志&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>Instr:<br>作用：获取子串第一次出现的索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;欧阳荣多对多&#x27;</span>, <span class="string">&#x27;欧阳&#x27;</span>);</span><br><span class="line">结果为：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><p>Round:<br>作用：四舍五入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一种使用：</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.65</span>);</span><br><span class="line">结果：<span class="number">2</span></span><br><span class="line"></span><br><span class="line">第二种使用：</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.657</span>, <span class="number">2</span>);</span><br><span class="line">结果：<span class="number">1.66</span></span><br></pre></td></tr></table></figure>

<p>Ceil：<br>作用：向上取整  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">1.52</span>);  </span><br><span class="line">结果：<span class="number">2</span></span><br></pre></td></tr></table></figure>


<p>Floor：<br>作用：向下取整  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">9.99</span>);</span><br><span class="line">结果：<span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>Truncate：<br>作用：截断  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">10.19</span>, <span class="number">1</span>);  </span><br><span class="line">结果：<span class="number">10.1</span></span><br></pre></td></tr></table></figure>

<p>Mod：<br>作用：取余  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">3</span>);  </span><br><span class="line">结果：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Rand：<br>作用：获取随机数，返回0-1之间的小数  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RAND();</span><br></pre></td></tr></table></figure>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>NOW：<br>作用：返回当前系统日期+时间<br>SELECT NOW();</p>
<p>Curdate：<br>作用：返回当前系统日期，不包含时间<br>SELECT CURDATE();</p>
<p>Curtime：<br>作用：返回当前时间，不包含日期<br>SELECT CURTIME();</p>
<p>Year：<br>作用：获取年<br>Select year(now());<br>SELECT YEAR(‘1999-1-1’) 年;</p>
<p>Month:<br>作用：获取月<br>SELECT MONTH(NOW()) 月;</p>
<p>Day:<br>作用：获取日<br>Select DAY(now()) 日;</p>
<p>日期格式符：</p>
<p>Str_to_date:<br>作用：将日期格式的字符转换成指定格式的日期<br>SELECT STR_TO_DATE(‘1999-6-2’, ‘%Y-%c-%d’) out_put;<br>SELECT * FROM employees WHERE hiredate=STR_TO_DATE(‘4-3 1992’, ‘%c-%d %Y’);</p>
<p>Date_format：<br>作用：将日期转换成字符<br>SELECT DATE_FORMAT(NOW(), ‘%y年%m月%d日’) AS out_put;</p>
<p>案例：查询有奖金的员工名和入职日期（xx月/xx日 xx年）<br>SELECT last_name, DATE_FORMAT(hiredate, ‘%M月/%d日 %y年’)<br>FROM employees<br>WHERE commission_pct IS NOT NULL;</p>
<p>Datediff：<br>作用：返回两个日期相差的天数<br>SELECT DATEDIFF(NOW(), ‘1999-06-24’);</p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><p>VERSION：<br>作用：查看当前mysql版本号<br>SELECT VERSION();</p>
<p>DATABASE：<br>作用：查看当前打开的数据库<br>Select DATABASE();</p>
<p>USER：<br>作用：查看当前登录的用户<br>Select USER();</p>
<h3 id="流程控制函数"><a href="#流程控制函数" class="headerlink" title="流程控制函数"></a>流程控制函数</h3><p>If：<br>作用：判断真假<br>SELECT IF(10&lt;5, ‘小’, ‘大’);</p>
<p>Case:<br>作用：判断<br>语法：<br>case 要带的字段或表达式<br>when 常量1 then 要显示的值1或语句1;<br>when 常量1 then 要显示的值1或语句1;<br>…..<br>else 要显示的值n或语句n<br>End</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">案例：查询员工的工资，要求</span><br><span class="line">部门号<span class="operator">=</span><span class="number">30</span>,显示的工资为<span class="number">1.1</span>倍</span><br><span class="line">部门号<span class="operator">=</span><span class="number">40</span>，显示的工资为<span class="number">1.2</span>倍</span><br><span class="line">部门号<span class="operator">=</span><span class="number">50</span>，显示的工资为<span class="number">1.3</span>倍</span><br><span class="line">其他部门，显示的工资为原工资</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary 原工资, </span><br><span class="line"><span class="keyword">CASE</span> department_id</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary<span class="operator">*</span><span class="number">1.1</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">40</span> <span class="keyword">THEN</span> salary<span class="operator">*</span><span class="number">1.2</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> salary<span class="operator">*</span><span class="number">1.3</span></span><br><span class="line"><span class="keyword">ELSE</span> salary</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 新工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">案例：查询员工的工资的情况</span><br><span class="line">如果工资<span class="operator">&gt;</span><span class="number">20000</span>，显示A级别</span><br><span class="line">如果工资<span class="operator">&gt;</span><span class="number">15000</span>，显示B级别</span><br><span class="line">如果工资<span class="operator">&gt;</span><span class="number">10000</span>,显示C级别</span><br><span class="line">否则，显示D级别</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">20000</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> salary<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 级别</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><p>sum:<br>作用：求和<br>SELECT SUM(salary) FROM employees;</p>
<p>max:<br>作用：最大值<br>Select max(salary) from employees;</p>
<p>min：<br>作用：最小值<br>SELECT MIN(salary) FROM employees;</p>
<p>avg：<br>作用：平均数<br>SELECT AVG(salary) FROM employees;</p>
<p>count：<br>作用：计算个数<br>Select count(*) from user;</p>
<p>注意事项：<br>sum，avg一般用于数值型<br>max，min，count可以处理任何类型<br>以上分组函数都忽略null值</p>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><p>语法：<br>select 分组函数，列（要求出现在group by的后面）<br>from 表<br>[where 筛选条件]<br>group by 分组的列表<br>[having 分组后的筛选]<br>[order by 子句]</p>
<p>注意：<br>查询列表必须特殊，要求是分组函数或group by后出现的字段<br>分组后筛选在group by子句的后面使用 having 关键字<br>分组函数做条件肯定是放在having子句中<br>能用分组前筛选，就优先使用分组前筛选<br>group by 子句支持单个字段分组，多个字段分组（用逗号隔开）</p>
<p>简单分组：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#案例<span class="number">1</span>：查询每个部门的平均工资</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">AVG</span>(salary) 平均工资 <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id; </span><br><span class="line"></span><br><span class="line">#案例<span class="number">2</span>：查询每个工种的最高工资</span><br><span class="line"><span class="keyword">SELECT</span> job_id, <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">3</span>：查询每个位置上的部门个数</span><br><span class="line"><span class="keyword">SELECT</span> location_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> departments <span class="keyword">GROUP</span> <span class="keyword">BY</span> location_id;</span><br></pre></td></tr></table></figure>

<p>添加筛选条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#案例<span class="number">1</span>：查询邮箱中包含a字符的，每个部门的平均工资</span><br><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">2</span>：查询有奖金的每个领导手下的最高工资</span><br><span class="line"><span class="keyword">SELECT</span> manager_id, <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">3</span>：查询哪个部门的员工个数<span class="operator">&gt;</span><span class="number">2</span></span><br><span class="line"><span class="keyword">Select</span> department_id, <span class="built_in">count</span>(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> department_id <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">4</span>：查询每个工种有奖金的员工的最高工资<span class="operator">&gt;</span><span class="number">12000</span>的工种编号和最高工资</span><br><span class="line"><span class="keyword">SELECT</span> job_id, <span class="built_in">MAX</span>(salary) </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id <span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary)<span class="operator">&gt;</span><span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">5</span>：查询领导编号<span class="operator">&gt;</span><span class="number">102</span>的每个领导手下的最低工资<span class="operator">&gt;</span><span class="number">5000</span>的领导编号是哪个</span><br><span class="line"><span class="keyword">SELECT</span> manager_id, <span class="built_in">MIN</span>(salary) </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> manager_id<span class="operator">&gt;</span><span class="number">102</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id <span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary)<span class="operator">&gt;</span><span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">6</span>：按员工姓名长度分组，查询每一组的员工个数，筛选员工个数<span class="operator">&gt;</span><span class="number">5</span>的有哪些</span><br><span class="line"><span class="keyword">SELECT</span> last_name, LENGTH(last_name), <span class="built_in">COUNT</span>(<span class="operator">*</span>) 员工个数 </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> LENGTH(last_name) <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>什么是连接查询：<br>又称多表查询，当查询的字段来自多个表时，就会用到连接查询。</p>
<p>笛卡尔积:<br>笛卡尔积乘积现象：表1 有m行，表2有n行，结果=m*n行</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>按年代分类：<br>sql92标准：仅仅支持内连接<br>sql99标准【推荐】：支持内连接+外连接（左外和右外）+交叉连接</p>
<p>按功能分类：</p>
<ul>
<li>内连接：  <ul>
<li>等值连接  </li>
<li>非等值连接  </li>
<li>自连接  </li>
</ul>
</li>
<li>外连接：  <ul>
<li>左外连接  </li>
<li>右外连接  </li>
<li>全外连接（mysql不支持）  </li>
</ul>
</li>
<li>交叉连接：  </li>
</ul>
<h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><p>Select 查询列表<br>From 表1 别名 【连接类型】<br>Join 表2 别名<br>On 连接条件<br>【where 筛选条件】<br>【group by 分组】<br>【having 分组后筛选】<br>【order by 排序列表】</p>
<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>Sql192语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">（1）等值连接</span><br><span class="line">案例：</span><br><span class="line">查询女神名和对应男生名</span><br><span class="line">SELECT b.name,bs.boyName </span><br><span class="line">FROM beauty b, boys bs </span><br><span class="line">WHERE b.boyfriend_id = bs.id;</span><br><span class="line"></span><br><span class="line">查询员工名和对应的部门名</span><br><span class="line">SELECT e.last_name, e.department_id, d.department_name </span><br><span class="line">FROM employees e, departments d </span><br><span class="line">WHERE e.department_id=d.department_id;</span><br><span class="line"></span><br><span class="line">查询有奖金的员工名，部门名</span><br><span class="line">SELECT e.`last_name`, d.`department_id`, e.`commission_pct` </span><br><span class="line">FROM employees e,departments d </span><br><span class="line">WHERE e.`department_id`=d.`department_id` AND commission_pct IS NOT NULL;</span><br><span class="line"></span><br><span class="line">查询每个工种的工种名和员工的个数，并且按员工个数降序</span><br><span class="line">SELECT j.job_title, COUNT(*) </span><br><span class="line">FROM employees e, jobs j </span><br><span class="line">WHERE e.`job_id`=j.`job_id` </span><br><span class="line">GROUP BY j.`job_title` ORDER BY COUNT(*) DESC;</span><br><span class="line"></span><br><span class="line">（2）非等值连接</span><br><span class="line">案例：</span><br><span class="line">查询员工的工资和工资级别</span><br><span class="line">SELECT e.`salary`, j.`grade_level` </span><br><span class="line">FROM employees e, job_grades j</span><br><span class="line">WHERE e.`salary` BETWEEN j.`lowest_sal` AND j.`highest_sal` AND j.`grade_level`=&#x27;E&#x27;;</span><br><span class="line"></span><br><span class="line">（3）自连接</span><br><span class="line">查询员工名和上级的名称</span><br><span class="line">SELECT e1.last_name, e2.`last_name` </span><br><span class="line">FROM employees e1,  employees e2</span><br><span class="line">WHERE e1.`manager_id`=e2.`employee_id`;</span><br><span class="line"></span><br><span class="line">三表连接：查询员工名，部门名和所在的城市</span><br><span class="line">SELECT e.last_name, d.`department_name`, l.`city` </span><br><span class="line">FROM employees e, departments d, locations l</span><br><span class="line">WHERE e.`department_id`=d.`department_id` AND d.`location_id`=l.`location_id`;</span><br></pre></td></tr></table></figure>

<p>sql99语法：Inner </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">查询员工名，部门名</span><br><span class="line"><span class="keyword">SELECT</span> e.last_name, d.`department_name` <span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.`department_id`<span class="operator">=</span>d.`department_id`;</span><br><span class="line"></span><br><span class="line">查询名字中只能包含e的员工名和工种名</span><br><span class="line"><span class="keyword">SELECT</span> e.last_name, j.`job_title` <span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.`job_id`<span class="operator">=</span>j.`job_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`last_name` <span class="keyword">LIKE</span> <span class="string">&#x27;%e%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">查询部门个数<span class="operator">&gt;</span><span class="number">3</span>的城市名和部门个数</span><br><span class="line"><span class="keyword">SELECT</span> l.`city`, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> locations l </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> l.`location_id` <span class="operator">=</span> d.`location_id`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> l.`city` <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">查询工资级别的个数<span class="operator">&gt;</span><span class="number">2</span>的个数，并按工资级别降序</span><br><span class="line"><span class="keyword">SELECT</span> j.`grade_level`, <span class="built_in">COUNT</span>(<span class="operator">*</span>) 个数 <span class="keyword">FROM</span> job_grades j</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> e.`salary` <span class="keyword">BETWEEN</span> j.`lowest_sal` <span class="keyword">AND</span> j.`highest_sal`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> j.`grade_level` <span class="keyword">HAVING</span> 个数<span class="operator">&gt;</span><span class="number">2</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 个数 <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>应用场景：用于查询一个表中有，另一个表没有</p>
<p>1.外连接的查询结构为主表中的所有记录<br>如果从表中有和它匹配的，则显示匹配值<br>如果从表中没有和它匹配的，则显示为null<br>外连接查询结果=内连接结果+主表中有而从表没有的数据</p>
<p>2.左外连接，left join左边的是主表<br>右外连接，right join右边的是主表  </p>
<p>3.左外和右外交换两个表的顺序，可以实现同样的效果</p>
<p>（1）左连接：<br>语法：Left 【outer】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查询没有男朋友的女神名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> beauty b </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo <span class="keyword">ON</span> b.`boyfriend_id`<span class="operator">=</span>bo.`id`</span><br><span class="line"><span class="keyword">WHERE</span> bo.`id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">查询哪个部门没有员工</span><br><span class="line"><span class="keyword">SELECT</span> d.`department_id`, d.`department_name` <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.`department_id`<span class="operator">=</span>e.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`employee_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.`department_id`;</span><br></pre></td></tr></table></figure>
<p>（2）右连接<br>语法：Right 【outer】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#查询没有男朋友的女神名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> boys bo </span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> b.`boyfriend_id`<span class="operator">=</span>bo.`id`</span><br><span class="line"><span class="keyword">WHERE</span> bo.`id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">查询哪个部门没有员工</span><br><span class="line"><span class="keyword">SELECT</span> d.`department_id`, d.`department_name` <span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.`department_id`<span class="operator">=</span>d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`employee_id` <span class="keyword">IS</span> <span class="keyword">NULL</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<p>（3）全外（mysql不支持）<br>语法：Full 【outer】</p>
<h3 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h3><p>语法：Cross</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">女神男神表交叉连接</span><br><span class="line"><span class="keyword">SELECT</span> b.<span class="operator">*</span>, bo.<span class="operator">*</span> <span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> boys bo;</span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><p>出现在其他语句的select语句，称为子查询或内出现<br>内部嵌套其他select语句的查询，称为外查询或主查询</p>
<h3 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h3><p>按子查询出现的位置：<br>1）select 后面<br>2）from 后面<br>3）wehre 或 having后面<br>4）exists后面（相关子查询）  </p>
<p>按结果集的行列数不同：<br>1）标量子查询（结果集只有一行一列）<br>2）列子查询（结果集只有一列多行）<br>3）行子查询（结果集有多行多列）<br>4）表子查询（结果集一般为多行多列）</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p><code>&gt; &lt; &lt;&gt; = </code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">谁的工资比 Abel 高？</span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary<span class="operator">&gt;</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> last_name<span class="operator">=</span><span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">返回job_id与<span class="number">141</span>号员工相同，salary比<span class="number">143</span>号员工多的员工姓名，job_id和工资</span><br><span class="line"><span class="keyword">SELECT</span> last_name,job_id,salary <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> job_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id<span class="operator">=</span><span class="number">141</span></span><br><span class="line">) <span class="keyword">AND</span> salary<span class="operator">&gt;</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id<span class="operator">=</span><span class="number">141</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">案例<span class="number">3</span>：返回公司工资最少的员工的last_name,job_id和salary</span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span>（常用）：</span><br><span class="line">作用：可以是子查询中的任一一个</span><br><span class="line">返回location_id是<span class="number">1400</span>或<span class="number">1700</span>的部们中的所有员工姓名</span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> location_id <span class="keyword">IN</span>(<span class="number">1400</span>, <span class="number">1700</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">Any</span>（不常用）：</span><br><span class="line">作用：任一一个</span><br><span class="line"></span><br><span class="line">返回其他部门中比job_id为‘IT_PROG’部门任一工资低的员工的员工号，姓名，job_id,以及salasy</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id,salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary<span class="operator">&lt;</span><span class="keyword">ANY</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> job_id<span class="operator">=</span><span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> department_id<span class="operator">&lt;&gt;</span><span class="string">&#x27;IT_PROG&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">All</span>（不常用）：</span><br><span class="line">作用：所有的</span><br><span class="line"></span><br><span class="line">返回其他部门中比job_id为‘IT_PROG’部门所有工资低的员工的员工号，姓名，job_id,以及salasy</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id,salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary<span class="operator">&lt;</span><span class="keyword">ALL</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> job_id<span class="operator">=</span><span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> department_id<span class="operator">&lt;&gt;</span><span class="string">&#x27;IT_PROG&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="分页查询（常用）"><a href="#分页查询（常用）" class="headerlink" title="分页查询（常用）"></a>分页查询（常用）</h2><p>应用场景：当要显示的数据，一页显示不全，需要分页提交sql请求。</p>
<h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><p>select 参数列表<br>from 表<br>left join 表名 on 连接条件<br>where 筛选条件<br>group by 分组字段 having 分组后筛选<br>order by 排序字段<br>limit 【offset,】 size；</p>
<p>offset 要显示条目的起始索引（起始索引从0开始）<br>size 要显示的条目个数<br>特点：limit语句放在查询语句的最后</p>
<h3 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h3><p>查询第二页，一页10条记录<br>Select * from user limit 10, 10;</p>
<h2 id="Union联合查询"><a href="#Union联合查询" class="headerlink" title="Union联合查询"></a>Union联合查询</h2><p>union 联合 合并：将多条查询语句的结果合并成一个结果</p>
<p>应用场景：要查询的结果来自于多个表，且多个表没有证据的连接关系，单查询的信息一致时</p>
<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><p>查询语句1<br>union<br>查询语句2<br>union<br>….</p>
<p>特点：<br>1.要求多条查询语句的查询列数是一致的<br>2.要求多条查询语句的查询的每一列的类型和顺序最好一致<br>3.union关键字默认去重，如果使用union all 可以包含重复项</p>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Union</span></span><br><span class="line"><span class="keyword">Select</span> id, name <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">Union</span></span><br><span class="line"><span class="keyword">Select</span> id,name <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Union all</span></span><br><span class="line"><span class="keyword">Select</span> id, name <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">Union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">Select</span> id,name <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h1 id="DML语言"><a href="#DML语言" class="headerlink" title="DML语言"></a>DML语言</h1><p>数据库操作语言：<br>插入：insert<br>修改：update<br>删除：delete</p>
<h2 id="插入语句"><a href="#插入语句" class="headerlink" title="插入语句"></a>插入语句</h2><h3 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h3><p>语法：<br>Inser into 表名(列名, …) values(值1, …);</p>
<p>使用：<br>INSERT INTO users VALUES(1, ‘欧阳荣’, ‘男’, 166842.5);<br>INSERT INTO users(id, NAME, sex, gz) VALUES(2, ‘赵云彬’, ‘欧阳荣’, NULL);</p>
<h3 id="方式2"><a href="#方式2" class="headerlink" title="方式2"></a>方式2</h3><p>语法：<br>insert into 表名 set 列名=值,列名=值,….;</p>
<p>使用：<br>INSERT INTO boys SET id=6, boyName=’侄子’, userCp=147258;</p>
<h3 id="两种开发方式pk"><a href="#两种开发方式pk" class="headerlink" title="两种开发方式pk"></a>两种开发方式pk</h3><p>insert方式一次可以加多条，第二种方式不行<br>INSERT INTO boys VALUES(7, ‘欧阳荣’, 10000000), (8, ‘欧阳荣’, 10000000);</p>
<p>insert方式可以用子查询<br>INSERT INTO boys SELECT 10, ‘ii’, 150044;</p>
<h2 id="修改语句"><a href="#修改语句" class="headerlink" title="修改语句"></a>修改语句</h2><h3 id="修改单表的记录（常用）"><a href="#修改单表的记录（常用）" class="headerlink" title="修改单表的记录（常用）"></a>修改单表的记录（常用）</h3><p>语法：<br>Update 表名 set 列=新值, 列=新值…. where 筛选条件;</p>
<p>案例：<br>修改beauty表中姓唐的女神电话为1389988889<br>UPDATE beauty SET phone=’1389988889’ WHERE NAME LIKE ‘唐%’;</p>
<p>修改boys表中id号为2的名称为张飞，魅力值10<br>UPDATE boys SET boyName=’张飞’, userCP=10 WHERE id=2;</p>
<p>4.2.2.修改多表的记录（补充）<br>192语法：<br>UPDATE 表名 别名,表名 别名<br>SET 列=值,列=值 …<br>WHERE 连接添加 AND 筛选条件</p>
<p>199语法:<br>UPDATE 表名 别名<br>INNER|LEFT|RIGHT| JOIN 表名 别名 ON 连接条件<br>SET 列=值，列=值 …<br>WHERE 筛选条件</p>
<p>案例（以下实现都为199语法）：</p>
<p>修改张无忌的女朋友的手机号为114<br>UPDATE boys bo<br>INNER JOIN beauty b ON bo.id=b.boyfriend_id<br>SET phone=’114’<br>WHERE bo.boyName=’张无忌’;</p>
<p>修改没有男朋友的女神的男朋友的编号都为2号<br>UPDATE boys bo<br>RIGHT JOIN beauty b ON bo.id=b.boyfriend_id<br>SET b.boyfriend_id=2<br>WHERE bo.id IS NULL;</p>
<p>4.3.删除语句</p>
<p>4.3.1.方式1：delete<br>语法：<br>（1）单表删除（重要）：<br>Delete from 表名 where 筛选条件;</p>
<p>（2）多表删除（补充）<br>192：<br>Delete 表1别名, 表2别名<br>from 表一 别名, 表二别名<br>Where 连接条件 and 筛选条件</p>
<p>199：<br>Delete 表1别名, 表2别名<br>From 表一 别名<br>inner|Left|right| join 表2 别名 on 连接条件<br>Where 筛选条件</p>
<p>案例：</p>
<p>删除手机号以9结尾的女神信息<br>DELETE FROM beauty WHERE phone LIKE ‘%9’;</p>
<p>删除张无忌的女朋友的信息<br>DELETE b FROM beauty b INNER JOIN boys bo ON bo.id=b.boyfriend_id<br>WHERE bo.<code>boyName</code>=’张无忌’;</p>
<p>删除黄晓明的信息以及他女朋友的信息<br>DELETE b, bo FROM boys bo<br>INNER JOIN beauty b ON bo.<code>id</code>=b.<code>boyfriend_id</code><br>WHERE bo.<code>boyName</code>=’黄晓明’;</p>
<p>4.3.2.方式2：truncate<br>语法：<br>Truncate table 表名;</p>
<p>特点：<br>不能加筛选条件，也叫做清空。</p>
<p>4.3.3.delete pk truncate（面试题）</p>
<p>1.delete可以加where条件，truncate不可以<br>2.truncate删除，效率高一丢丢<br>3.假如删除的表中有自增长，使用delete删除后，再插入数据，自增长列的值从断点开始。<br>如果使用truncate删除后，再插入值，自增长列的值从1开始。<br>4.truncate删除没有返回值，delete删除有返回值<br>5.truncate删除不能回滚，delete删除可以回滚。</p>
<p>5.DDL语言<br>数据库定义语言，也就是库和表的管理</p>
<p>5.1.库的管理</p>
<p>5.1.1.库的创建</p>
<p>语法：<br>create database [if not exists] 库名 [character set 字符集]</p>
<p>案例：</p>
<p>创建一个db_book库<br>CREATE DATABASE IF NOT EXISTS db_oyr CHARACTER SET utf8;</p>
<p>5.1.2.库的修改</p>
<p>修改库名（现在不能用了）：<br>语法：<br>rename database 库名 to 新库名;</p>
<p>案例<br>把db_oyr库名改成my_oyr<br>RENAME DATABASE db_oyr TO my_oyr;</p>
<p>修改字符集：<br>语法：<br>alert database 库名 character set 字符集;</p>
<p>案例：</p>
<p>修改db_oyr的字符集为gbk<br>ALTER DATABASE db_oyr CHARACTER SET gbk;</p>
<p>5.1.3.库的删除</p>
<p>语法：<br>DROP DATABASE [IF EXISTS] 库名;</p>
<p>案例:<br>删除db_oyr<br>DROP DATABASE db_oyr; </p>
<p>5.2.表的管理</p>
<p>5.2.1.表的创建</p>
<p>语法：<br>create table 表名(<br>    列名 列类型【（类型长度） 约束】,<br>    列名 列类型【（类型长度） 约束】,<br>    列名 列类型【（类型长度） 约束】,<br>    …<br>    列名 列类型【（类型长度） 约束】<br>);</p>
<p>案例：<br>创建book表<br>CREATE TABLE book(<br>    id INT,#编号<br>    bName VARCHAR(20),#图书名<br>    price DOUBLE,#价格<br>    authorId INT,#作者编号<br>    publishDate DATETIME#出版日期<br>);</p>
<p>5.2.2.表的修改</p>
<p>语法：<br>Alter table 表名 add|drop|modify|change column 列名 【列类型 约束】</p>
<p>（1）修改列名</p>
<p>ALTER TABLE book CHANGE COLUMN bName myName VARCHAR(25);</p>
<p>（2）修改列的类型或约束</p>
<p>ALTER TABLE my_book MODIFY COLUMN myName INT;</p>
<p>（3）添加新列</p>
<p>ALTER TABLE book ADD COLUMN oo VARCHAR(20);</p>
<p>（4）删除列</p>
<p>ALTER TABLE book DROP COLUMN oo;</p>
<p>（5）修改表名</p>
<p>ALTER TABLE book RENAME TO my_book;</p>
<p>5.2.3.表的删除</p>
<p>语法：<br>DROP TABLE 【IF EXISTS】 表名;</p>
<p>案例：</p>
<p>删除my_book表<br>DROP TABLE IF EXISTS my_book;</p>
<p>5.2.4.表的复制<br>1)复制表的结构<br>语法：<br>Create table 新表名 like 被复制的表名;</p>
<p>复制boys的结构<br>CREATE TABLE copy LIKE boys;</p>
<p>2)复制表的结构和数据<br>语法：<br>Create table 新表名<br>Select * from 被复制表的表名</p>
<p>复制boys表的结构和数据<br>CREATE TABLE copy2<br>SELECT * FROM boys;</p>
<p>复制boys部门数据和部分列<br>CREATE TABLE copy3<br>SELECT id,boyName FROM boys WHERE id&lt;5;<br>SELECT * FROM copy3;</p>
<p>复制几个字段的结构<br>CREATE TABLE copy4<br>SELECT id, boyName FROM boys<br>WHERE 1=2;</p>
<p>5.3.常见的约束</p>
<p>5.3.1.约束介绍</p>
<p>六大约束：<br>NOT NULL：非空约束，用于保证该字段的值不能为空<br>UNIQUE：唯一约束，用于保证该字段的值有唯一性，可以为空<br>PRIMARY KEY：主键约束，用于保证该字段的值有唯一性，并且不能为空<br>CHEACK：检查约束【MYSQL中不支持，没有效果】<br>FOREIGN KEY：外检约束，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值，用于引用主表中某列的值<br>DEFAULT：默认值，用于保证字段有默认值</p>
<p>添加约束的时机：<br>创建表时<br>修改表时</p>
<p>约束的添加分类：<br>列级约束：<br>六大约束语法上都支持，单外检约束没有效果<br>表级约束：<br>除了非空，默认，其他都支持</p>
<p>列级约束 VS 表级约束<br>位置            支持的约束类型                    是否可以起别名<br>列级：    列的后面        都支持，但外键没有效果            不可以<br>表级：    所有列的下面    默认和非空不支持，其他都支持    可以主键（没有效果）</p>
<p>5.3.2.添加列级约束</p>
<p>新建一个库students，在里面测试添加列级约束</p>
<h1 id="新建主修表"><a href="#新建主修表" class="headerlink" title="新建主修表"></a>新建主修表</h1><p>create table major(<br>    id bigint(20) primary key, #主键约束<br>    major_name varchar(25) NOT NULL #非空约束<br>)</p>
<h1 id="新建学生表"><a href="#新建学生表" class="headerlink" title="新建学生表"></a>新建学生表</h1><p>create table student(<br>    id bigint(20) primary key, #主键约束<br>    stu_name varchar(25) NOT NULL, #非空约束<br>    sex char(2) CHECK(sex = ‘男’ or sex = ‘女’), #检查约束<br>    age int default 20, #默认约束<br>    card varchar(25) unique,#唯一约束<br>    major_id bigint(20) REFERENCES major(id) #外键约束<br>)</p>
<p>经过测试后发现，检查约束是无效的，而且外检约束也是无效的。<br>其他都是ok的。</p>
<p>5.3.3.添加表级约束</p>
<p>语法：<br>在表字段的最下面<br>[constraint 约束名] 约束类型(字段名)<br>表级约束添加外键是有效的。</p>
<p>指定约束名创建约束：<br>CREATE TABLE student (<br>  id bigint(20) NOT NULL,<br>  stu_name varchar(25) NOT NULL,<br>  sex char(2) DEFAULT NULL,<br>  age int(11) DEFAULT ‘20’,<br>  card varchar(25) DEFAULT NULL,<br>  major_id bigint(20) DEFAULT NULL,<br>  CONSTRAINT pk PRIMARY KEY(id), #主键，约束名不生效<br>  CONSTRAINT un_card UNIQUE KEY(card), #唯一约束<br>CONSTRAINT ch_sex CHECK(sex = ‘女’ or sex =’男’),<br>  CONSTRAINT <code>pk_student_major</code> FOREIGN KEY (major_id) REFERENCES major(id)<br>);</p>
<p>不指定约束名创建约束：<br>CREATE TABLE student (<br>  id bigint(20) NOT NULL,<br>  stu_name varchar(25) NOT NULL,<br>  sex char(2) DEFAULT NULL,<br>  age int(11) DEFAULT ‘20’,<br>  card varchar(25) DEFAULT NULL,<br>  major_id bigint(20) DEFAULT NULL,<br>  PRIMARY KEY(id), #主键，约束名不生效<br>  UNIQUE KEY(card), #唯一约束<br>    CHECK(sex = ‘女’ or sex =’男’),<br>  FOREIGN KEY (major_id) REFERENCES major(id)<br>);</p>
<p>5.3.4.主键约束 VS 唯一约束</p>
<p>保证唯一性    是否允许为空    一个表中有几个    是否允许出现组合<br>主键        √            ×                最多一个        √，但不推荐<br>唯一        √            ×                可以多个        √，但不推荐</p>
<p>唯一约束可以允许为空，但null只能出现一次。<br>组合就是组合主键或组合唯一约束。</p>
<p>5.3.5.外键的特点</p>
<p>从表：当前表<br>主表：被关联的表</p>
<p>1.要求在从表中设置外键关系<br>2.从表的外键列的类型和主表的关联列的类型要求一致或兼容，名称无要求<br>3.主表的关联列必须是一个key（主键和唯一，不然会抛出异常）<br>4.插入数据时，先插入主表，再插入从表，删除数据时，先删除从表，再删除主表</p>
<p>5.3.6.修改表时添加约束</p>
<p>语法：<br>1.添加列级约束<br>alter table 表名 modify column 字段名 字段类型 新约束</p>
<p>2.添加表级约束<br>alter table 表名 add [constraint 约束名] 约束类型(字段名)  [外键的引用]</p>
<p>添加非空约束：<br>列级：<br>alter table student modify column stu_name varchar(25) not null;</p>
<p>添加默认约束：<br>列级：<br>alter table student modify column age int default 20</p>
<p>添加主键约束：<br>列级：<br>alter table student modify column id bigint(20) primary key<br>表级：<br>alter table student add primary key(id)</p>
<p>添加唯一约束：<br>列级：<br>alter table student modify column card varchar(25) unique<br>表级：<br>alter table student add constraint un_card unique(card)</p>
<p>添加外键约束：<br>表级：<br>alter table student add constraint fk_student_major foreign key(id) references major(id)</p>
<p>5.3.7.修改表时删除约束</p>
<p>1.删除非空约束（直接不写就是删除）<br>alter table student modify column stu_name varchar(25)</p>
<p>2.删除默认约束（不写即是删除）<br>alter table student modify column age int default 20</p>
<p>3.删除主键约束<br>aler table 表名 drop primary key</p>
<p>4.删除唯一约束<br>alter table 表名 drop index 约束名</p>
<p>5.删除外键约束<br>alter table 表名 drop foreign key 约束名</p>
<p>5.4.标识列</p>
<p>什么是标识列？<br>标识列是自增长列<br>含义：可以不手动的插入值，系统提供默认的序列值</p>
<p>特点：<br>1.标识列必须和key值搭配（也就是说当前列必须是主键或者唯一）<br>2.一个表只能有一个标识列<br>3.标识类的类型只能是数值型<br>4.标识列可以通过 set auto_increment_increment=3;设置步长。可以手动插入值来设置起始值</p>
<p>创建表时设置标识列<br>create table tb_user(<br>    id int primary key auto_increment, #主键并且设置标识列<br>    name varchar(25) not null<br>)</p>
<p>修改表时设置标识列<br>alter table tb_user modify column id int primary key auto_increment</p>
<p>修改表时删除标识列<br>alter table tb_user modify column id int primary key</p>
<p>6.TCL 语言<br>TCL：Transaction Control Language 事物控制语言</p>
<p>事务：事务由单独单元的一个或多个SQL语句组成，在这个单元中，每个MySQL语句是相互依赖的。而整个单独单元作为一个不可分割的整体，如果单元中某条SQL语句一旦执行失败或产生错误，整个单元将会回滚。所有受到影响的数据将返回到事物开始以前的状态；如果单元中的所有SQL语句均执行成功，则事物被顺利执行。</p>
<p>6.1.MySQL 中的存储引擎</p>
<p>1、概念：在mysql中的数据用各种不同的技术存储在文件（或内存）中。<br>2、通过show engines；来查看mysql支持的存储引擎。<br>3、 在mysql中用的最多的存储引擎有：innodb，myisam ,memory 等。其中innodb支持事务，而myisam、memory等不支持事务</p>
<p>6.2.事务的ACID属性</p>
<ol>
<li><p>原子性（Atomicity）<br>原子性是指事务是一个不可分割的工作单位，事务中的操作要么执行成功，要么都执行失败。</p>
</li>
<li><p>一致性（Consistency）<br>事务必须使数据库从一个一致性状态变换到另外一个一致性状态。拿转账为例，A有500元，B有300元，如果在一个事务里A成功转给B50元，那么不管并发多少，不管发生什么，只要事务执行成功了，那么最后A账户一定是450元，B账户一定是350元。不管转账多少次两个人的钱加起来都是800元。</p>
</li>
<li><p>隔离性（Isolation）<br>并发执行的各个事务之间不能互相干扰。事务的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的。</p>
</li>
<li><p>持久性（Durability）<br>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响。</p>
</li>
</ol>
<p>6.3.事物的使用步骤</p>
<p>事物又分两种：隐式事物和显式事物<br>隐式事物：事物没有明显的开启和结束的标记<br>列如insert，update，delete</p>
<p>显式事物：事物具有明显的开启和结束的标记<br>前提：必须设置自动提交功能为禁用</p>
<p>查看当前自动提交功能开关<br>show variables like ‘autocommit’</p>
<p>关闭自动提交功能，并不是永久的，只是当前回话被关闭<br>set autocommit=0;</p>
<p>开启事物的语法：<br>#步骤1：开启事物<br>set autocommit=0;<br>start transaction;#开启事物，可选的<br>#步骤2：编写事物中的sql语句（select insert update delete）<br>语句1;<br>语句2;<br>…….<br>#步骤3：结束事物<br>commit;#提交事物<br>rollback;回滚事物</p>
<p>实战操作：<br>初始化<br>create table account(<br>    id bigint(20) primary key auto_increment,<br>    acc_name varchar(25),<br>    money double<br>)<br>INSERT INTO account (id, acc_name, money) VALUES (1, ‘欧阳荣’, 1500);<br>INSERT INTO account (id, acc_name, money) VALUES (2, ‘罗总’, 500);</p>
<p>转账成功提交：执行后可以看到数据库数据已经改变了<br>set autocommit=0;<br>start transaction;<br>update account set money = money-500 where acc_name=’欧阳荣’;<br>update account set money = money+500 where acc_name=’罗总’;<br>commit;</p>
<p>转账失败回滚：执行后会发现数据并没有改变<br>set autocommit=0;<br>start transaction;<br>update account set money = money-500 where acc_name=’欧阳荣’;<br>update account set money = money+500 where acc_name=’罗总’;<br>rollback;</p>
<p>6.4.数据库的隔离级别</p>
<p>6.4.1.并发问题</p>
<p>对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题:</p>
<p>脏读: 对于两个事务 T1, T2, T1 读取了已经被 T2 更新但还没有被提交的字段.<br>之后, 若 T2 回滚, T1读取的内容就是临时且无效的.</p>
<p>不可重复读: 对于两个事务T1, T2, T1 读取了一个字段, 然后 T2 更新了该字段.<br>之后, T1再次读取同一个字段, 值就不同了.</p>
<p>幻读: 对于两个事务T1, T2, T1 从一个表中读取了一个字段, 然后 T2 在该表中插<br>入了一些新的行. 之后, 如果 T1 再次读取同一个表, 就会多出几行。</p>
<p>数据库事务的隔离性: 数据库系统必须具有隔离并发运行各个事务的能力, 使它们不会相互影响, 避免各种并发问题。</p>
<p>一个事务与其他事务隔离的程度称为隔离级别. 数据库规定了多种事务隔离级别, 不同隔离级别对应不同的干扰程度, 隔离级别越高, 数据一致性就越好, 但并发性越弱。</p>
<p>6.4.2.四种事务隔离级别</p>
<p>Oracle支持2种事务隔离级别：READ COMMITED, SERIALIZABLE。Oracle 默认的事务隔离级别为: READ COMMITED。</p>
<p>Mysql支持4种事务隔离级别。Mysql 默认的事务隔离级别为: REPEATABLE READ。</p>
<p>6.5.回滚点使用（savepotion）</p>
<p>set autocommit=0;#设置不自动提交<br>start transaction;#开启事物<br>delete form account where id=1;<br>savepoint a;#保存点<br>delete from account where id=2;<br>rollback to a;#回滚到保存点<br>这上面的sql意思是只回滚到保存点，其实就是删除了id=1的数据，id=2的数据并没有被删除。</p>
<p>7.视图<br>7.1.什么是视图</p>
<p>含义：虚拟表，和普通表一样使用<br>MySQL从5.0.1版本开始提供视图功能。一种虚拟存在的表，行和列的数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的，只保存了sql逻辑，不保存查询结果。</p>
<p>应用场景：<br>1.多个地方用到同样的查询结果<br>2.该查询结果使用的sql语句较复杂</p>
<p>7.2.视图的创建</p>
<p>语法：<br>create  [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]<br>view 视图名 as<br>查询语句<br>[WITH [CASCADED | LOCAL] CHECK OPTION]</p>
<p>OR REPLACE：表示替换已有视图</p>
<p>ALGORITHM：表示视图选择算法，默认算法是UNDEFINED(未定义的)：MySQL自动选择要使用的算法 ；merge合并；temptable临时表</p>
<p>[WITH [CASCADED | LOCAL] CHECK OPTION]：<br>表示视图在更新时保证在视图的权限范围之内<br>cascade是默认值，表示更新视图的时候，要满足视图和表的相关条件<br>local表示更新视图的时候，要满足该视图定义的一个条件即可<br>推荐使用WHIT [CASCADED|LOCAL] CHECK OPTION选项，可以保证数据的安全性 </p>
<p>实际操作：</p>
<p>1.查询邮箱中包含a字符的员工名，部门名，工种信息<br>– 创建视图<br>create view view_test1<br>AS<br>SELECT<br>    CONCAT(e.first_name, e.last_name) 员工名,<br>    dept.department_name 部门名,<br>    j.job_title 工种信息<br>FROM<br>    employees e<br>LEFT JOIN departments dept ON dept.department_id = e.department_id<br>LEFT JOIN jobs j ON j.job_id = e.job_id<br>where email LIKE ‘%a%’<br>– 查询视图<br>select * from view_test1</p>
<p>2.查询各部门的平均工资级别<br>create view view_test2<br>as<br>SELECT<br>    dept.department_name dept_name,<br>    AVG(e.salary) ag<br>FROM<br>    departments dept<br>LEFT JOIN employees e ON dept.department_id = e.department_id<br>GROUP BY dept.department_name</p>
<p>SELECT<br>    vt.dept_name,<br>    jb.grade_level<br>FROM<br>    view_test2 vt<br>LEFT JOIN job_grades jb ON vt.ag BETWEEN jb.lowest_sal<br>AND jb.highest_sal</p>
<p>3.查询平均工资最低的部门<br>create view view_test3<br>as<br>SELECT<br>    dept.department_name dept_name,<br>    AVG(e.salary) ag<br>FROM<br>    departments dept<br>LEFT JOIN employees e ON dept.department_id = e.department_id<br>GROUP BY dept.department_name having ag is not null<br>order by ag asc limit 0, 1</p>
<p>4.查询平均工资最低的部门名和工资<br>create view view_test4<br>as<br>SELECT<br>    dept.department_name dept_name,<br>    AVG(e.salary) ag<br>FROM<br>    departments dept<br>LEFT JOIN employees e ON dept.department_id = e.department_id<br>GROUP BY dept.department_name having ag is not null<br>order by ag asc limit 0, 1</p>
<p>视图的好处：<br>重用sql语句<br>简化复杂的sql操作，不必知道它的查询细节<br>保护数据，提高安全性</p>
<p>7.3.视图的修改</p>
<p>方式一：如果存在，则覆盖<br>create  [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]<br>view 视图名 as<br>查询语句<br>[WITH [CASCADED | LOCAL] CHECK OPTION]</p>
<p>方式二：指定修改视图<br>alter<br>[ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]<br>    [DEFINER = { user | CURRENT_USER }]<br>    [SQL SECURITY { DEFINER | INVOKER }]<br>view 视图名<br>as<br>查询语句<br>[WITH [CASCADED | LOCAL] CHECK OPTION];</p>
<p>方式一实际操作：<br>create or replace view view_test4<br>as<br>select * from employees where employee_id &gt; 105</p>
<p>方式二实际操作：<br>alter view view_test4<br>as<br>select * from employees where employee_id &gt; 120</p>
<p>7.4.视图的删除</p>
<p>语法：<br>drop view 视图名,视图名,视图名……..</p>
<p>实际操作：<br>drop view view_test4, view_test3</p>
<p>7.5.查看视图<br>方式1：desc 视图名</p>
<p>方式2：show create view 视图名</p>
<p>方式1实际操作：<br>desc view_test2</p>
<p>可以看到实际上能看到的是当前视图可以查询出的字段信息</p>
<p>方式2实际操作：<br>show create view view_test2</p>
<p>可以看到的是当前拿到的是创建视图的逻辑sql。</p>
<p>7.6.视图VS表</p>
<p>创建语法的关键字    是否实际占用物理空间    使用<br>视图    create view            只是保存了逻辑sql        增删改查，一般不能增删改查</p>
<p>表        create table            保存了数据                增删改查</p>
<p>8.变量</p>
<p>8.1.系统变量</p>
<p>说明：变量由系统提供的，不是银行定义，属于服务器层面<br>系统变量又可以细分为全局变量和局部变量</p>
<p>使用的语法：<br>1.查看所有的系统变量<br>show global|[session] variables</p>
<p>2.查看满足条件的部分系统变量<br>show global | [session] variables like ‘%char%’;</p>
<p>3.查看指定的某个系统变量的值<br>select @@global | [session] .系统变量名</p>
<p>4.为某个系统变量赋值<br>方式一：<br>set global | [session] 系统变量名 = 值;</p>
<p>方式二：<br>Set @@global | [session] .系统变量名 = 值;</p>
<p>注意：如果是全局级别，则需要加global，如果是会话级别，则需要加session，如果不写，则默认是session级别</p>
<p>8.1.1.全局变量实际操作</p>
<p>作用域：服务器每次启动将为所有的全局变量赋初始值，针对所有会话（连接）</p>
<p>（1）查看所有的全局变量<br>show global variables;</p>
<p>（2）查看部分的全局变量<br>show global variables like ‘%char%’;</p>
<p>（3）查看指定的全局变量的值<br>select @@global.autocommit;</p>
<p>（4）为某个指定的全局变量赋值<br>set @@global.autocommit = 0;</p>
<p>8.1.2.局部变量实际操作</p>
<p>作用域：仅仅针对于当前会话（连接）有效</p>
<p>（1）查看所有的会话变量<br>show variables<br>show session variables</p>
<p>（2）查看部分的会话变量<br>show variables like ‘%char%’<br>show session variables like ‘%char%’</p>
<p>（3）指定查看某个会话变量<br>select @@character_set_client<br>select @@session.character_set_client</p>
<p>（4）为某个会话变量赋值<br>set autocommit=0<br>set @@session.autocommit=1</p>
<p>8.2.自定义变量</p>
<p>说明：变量是用户自定义的，不是由系统自动生成的。<br>自定义变量又可以细分成用户变量（当前会话有效），局部变量<br>使用步骤：<br>声明<br>赋值<br>使用（查看，比较，运算等）</p>
<p>8.2.1.用户变量</p>
<p>作用域：针对于电器干会话（连接）有效，同于会话变量的作用域<br>应用在任何地方，也就是begin end里面或begin end外面</p>
<p>使用语法：</p>
<p>（1）声明并初始化：<br>set @用户变量名=值 或<br>set @用户变量名:=值 或<br>select @用户变量名:=值</p>
<p>（2）赋值（更新用户变量的值）<br>方式一：通过set和select<br>set @变量名=值 或<br>set @变量名:=值 或<br>select @变量名:=值</p>
<p>方式二：通过select into<br>select 字段 INTO @变量名<br>from 表</p>
<p>（3）使用（查看用户变量的值）<br>select @用户变量名</p>
<p>实际操作：</p>
<p>声明并且初始化：</p>
<h1 id="声明并且初始化"><a href="#声明并且初始化" class="headerlink" title="声明并且初始化"></a>声明并且初始化</h1><p>set @name=’欧阳荣’;<br>set @name:=10;<br>select @name:=’罗总’;</p>
<p>赋值：<br>#赋值<br>set @count = 10;<br>set @count := 15;<br>select @count := 20;<br>select count(*) into @count from account;</p>
<p>使用：<br>select @count;</p>
<p>8.2.2.局部变量</p>
<p>作用域：仅仅在定义它的begin end中有效，应用在begin end的第一句</p>
<p>（1）声明<br>declare 变量名 类型;<br>declare 变量名 类型 default 值;</p>
<p>（2）赋值<br>方式一：通过set和select<br>set 局部变量名=值 或<br>set 局部变量名:=值 或<br>select @局部变量名:=值</p>
<p>方式二：通过select into<br>select 字段 INTO 局部变量名<br>from 表</p>
<p>（3）使用<br>select 局部变量名</p>
<p>8.2.3.用户变量 VS 局部变量</p>
<p>作用域        定义和使用的位置                语法<br>用户变量    当前会话    会话中的任何地方                必须加@符，不限定类型<br>局部变量    begin end中    只能在begin end中，且为第一句    不用加@符，需要限定类型</p>
<p>9.存储过程和函数<br>存储过程和函数：类似于java中的方法<br>好处：<br>1、提高代码的重用性<br>2、简化操作</p>
<p>9.1.存储过程</p>
<p>含义：一组预先编译好的SQL语句的集合，理解成批处理语句<br>1、提高代码的重用性<br>2、简化操作<br>3、减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</p>
<p>9.1.1.创建&amp;调用&amp;查看&amp;删除语法</p>
<p>创建语法：<br>create procedure 存储过程名(参数列表)<br>begin<br>存储过程体（一组合法的SQL语句）<br>end</p>
<p>注意：<br>1.参数列表包含三部分<br>参数模式    参数名    参数类型<br>in            student    varchar(20)</p>
<p>参数模式：<br>in：    该参数可以作为输入，也就是该参数需要调用方法传入值<br>out：    该参数可以作为输出，也就是该参数可以作为返回值<br>inout：    该参数既可以作为输入也可以作为输出，也就是该参数即需要传入值，又可以返回值</p>
<p>2.如果存储过程体仅仅只有一句话，begin end可以省略。<br>存储过程的每条SQL语句的结尾要求必须加上分号。<br>存储过程的结尾可以使用delimiter重新设置<br>语法：<br>DELIMITER 结束标记<br>DELIMITER $</p>
<p>调用语法：<br>CALL 存储过程名（实参列表）</p>
<p>查看语法：<br>show create procedure 存储过程名;</p>
<p>删除语法：<br>drop procedure 存储过程名;</p>
<p>9.1.2.存储过程实战</p>
<p>（1）空参的存储过程：</p>
<h1 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h1><p>create procedure myp1()<br>begin<br>    insert into admin(name, money) values(‘z1’, 11), (‘z2’, 22), (‘z3’, 33), (‘z4’, 44), (‘z5’, 55);<br>end;</p>
<p>#调用存储过程<br>CALL myp1();</p>
<p>带in模式参数的存储过程：<br>根据女神名获取男神信息</p>
<h1 id="创建存储过程-1"><a href="#创建存储过程-1" class="headerlink" title="创建存储过程"></a>创建存储过程</h1><p>create procedure myp1(in beauty_name varchar(25))<br>begin<br>    select bs.* from beauty b right join boys bs on b.boyfriend_id = bs.id where b.name = beauty_name;<br>end;</p>
<h1 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h1><p>call myp1(‘赵敏’)</p>
<p>根据用户名和密码判断是否能登录成功<br>– 创建存储过程<br>create procedure myp2(in username varchar(25), in password varchar(25))<br>begin<br>    declare result int default ‘0’;<br>    select count(*) INTO result from admin a where a.username = username and a.<code>password</code> = password;<br>    select if(result &gt; 0, ‘成功’, ‘失败’);<br>end;<br>– 调用<br>call myp2(‘john’, ‘8888’)</p>
<p>（2）带out模式的存储过程：</p>
<p>根据女神名，返回对应的男神名<br>#创建<br>create procedure myp3(in beauty_name varchar(25), out boy_name varchar(25))<br>begin<br>    select bs.boyName into boy_name from beauty b right join boys bs on b.boyfriend_id = bs.id where b.name = beauty_name;<br>end;<br>– 调用<br>set @boy_name=’’;<br>call myp3(‘赵敏’, @boy_name);<br>select @boy_name;</p>
<p>根据女神名，返回对应的男神名和男神魅力值<br>创建<br>create procedure myp4(in beauty_name varchar(25), out boy_name varchar(25), out user_cp int)<br>begin<br>    select bs.boyName, bs.userCP into boy_name,user_cp  from beauty b right join boys bs on b.boyfriend_id = bs.id where b.name = beauty_name;<br>end;</p>
<p>– 调用<br>set @boy_name=’’;<br>set @user_cp=0;<br>call myp4(‘赵敏’, @boy_name, @user_cp);<br>select @boy_name, @user_cp;</p>
<p>（3）带inout模式参数的存储过程</p>
<p>传入a和b两个值，最终a和b都翻倍并返回<br>#创建<br>create procedure myp5(inout x int, inout y int)<br>begin<br>    set x = x<em>2;<br>    set y = y</em>2;<br>end;<br>#调用<br>set @x = 10;<br>set @y = 20;<br>call myp5(@x, @y);<br>select @x, @y;</p>
<p>9.2.函数</p>
<p>含义：一组预先编译好的SQL语句的集合，理解成批处理语句<br>1、提高代码的重用性<br>2、简化操作<br>3、减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</p>
<p>存储过程与函数的区别：<br>存储过程：可以有0个返回，也可以与多个返回，适合做批量插入，批量更新<br>函数：有且仅有一个返回，适合做处理数据后返回一个结果，适合做处理数据后返回一个结果</p>
<p>9.2.1.创建&amp;调用&amp;查看&amp;删除语法</p>
<p>创建语法：<br>create function 函数名(参数列表) returns 返回类型<br>begin<br>函数体<br>end</p>
<p>注意：<br>1.参数列表包含两部分：参数名 参数类型<br>2.函数体：肯定会有return语句，如果没有会报错。<br>如果return语句没有放在函数体的最后也不报错，但不建议。<br>3.函数体重仅有一句话，则可以省略begin end<br>4.使用delimiter语句设置结束标记</p>
<p>调用语法：<br>select 函数名（参数列表）</p>
<p>查看语法：<br>show create function 函数名</p>
<p>删除语法：<br>dorp function 函数名</p>
<p>9.2.2.函数实战</p>
<p>（1）无参有返回</p>
<p>返回公司的员工个数：<br>#创建<br>create function myf1() returns int<br>begin<br>    declare count int default 0;<br>    select COUNT(*) into count from employees;<br>    return count;<br>end;<br>#调用<br>select myf1();</p>
<p>（2）有参返回</p>
<p>根据员工名返回工资：<br>#创建<br>create function myf2(username varchar(25)) returns double<br>begin<br>    declare money double default 0;<br>    select salary into money from employees where last_name = username;<br>    return money;<br>end;<br>#调用<br>select myf2(‘Kochhar’);</p>
<p>根据部门名，发挥该部门的平均工资<br>#创建<br>create function myf3(dept_name varchar(25)) returns double<br>begin<br>    declare ave_salary double default 0;<br>    select avg(e.salary) into ave_salary from departments dept left join employees e on dept.department_id = e.department_id<br>    where dept.department_name = dept_name group by dept.department_id;<br>    return ave_salary;<br>end;<br>#调用<br>select myf3(‘Adm’);</p>
<p>实现传入两个float，返回两者之和：</p>
<p>#创建<br>create function myf1(x float, y float) returns float<br>begin<br>    declare sum float default 0;<br>    set sum = x + y;<br>    return sum;<br>end;<br>#调用<br>select myf1(1, 5.1);</p>
<p>（3）查看函数<br>show create function myf3;</p>
<p>（4）删除函数<br>drop function myf3</p>
<p>10.流程控制结构<br>顺序结构：程序从上往下依次执行<br>分支结构：程序从两条或多条路径中选择一条去执行<br>循环结构：程序在满足一定条件的基础上重复执行一段代码</p>
<p>10.1.分支结构</p>
<p>（1）if函数<br>功能：实现简单的双分支<br>语法：<br>If(表达式1, 表达式2, 表达式3)<br>执行顺序：<br>如果表达式1成立，则if函数返回表达式2的值，否则返回表达式3的值<br>应用：任何地方<br>实战操作：<br>select if(1 &gt; 2, 1, 2)<br>当前sql执行后会返回2</p>
<p>（2）case结构</p>
<p>在begin end 外面：</p>
<p>情况1：类似于java中的switch语句，一般用于实现等值的判断<br>case 变量|表达式|字段<br>when 要判断的值 then 返回的值1<br>when 要判断的值 then 返回的值2<br>….<br>else 返回的值n<br>end</p>
<p>情况2：类似于java的多重IF语句，一般用于视区间判断<br>case<br>when 要判断的条件1 then 返回的值1<br>when 要判断的条件2 then 返回的值2<br>….<br>else 返回的值n<br>end</p>
<p>在begin end里面：</p>
<p>情况1：类似于java中的switch语句，一般用于实现等值的判断<br>case 变量|表达式|字段<br>when 要判断的值 then 要执行的语句1<br>when 要判断的值 then 要执行的语句2<br>….<br>else 要执行的语句n<br>end case;</p>
<p>情况2：类似于java的多重IF语句，一般用于视区间判断<br>case<br>when 要判断的条件1 then 要执行的语句1<br>when 要判断的条件2 then 要执行的语句2<br>….<br>else 要执行的语句n<br>end case;</p>
<p>实战操作：</p>
<h1 id="创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80-显示C，否则显示D"><a href="#创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80-显示C，否则显示D" class="headerlink" title="创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80,显示C，否则显示D"></a>创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80,显示C，否则显示D</h1><p>create procedure show_grade(in grade int)<br>begin<br>    declare result varchar(2);<br>    CASE<br>    WHEN grade&gt;=90 and grade&lt;=100 THEN set result = ‘A’;<br>    WHEN grade&gt;=80 THEN set result = ‘B’;<br>    WHEN grade&gt;=60 THEN set result = ‘C’;<br>    ELSE set result = ‘D’;<br>    END CASE;<br>    select result;<br>end;</p>
<p>CALL show_grade(99);</p>
<p>#根据传递的数据库类型，显示对应的数据库名<br>create procedure show_database_type(in val int)<br>begin<br>    declare result varchar(20);<br>    CASE val<br>    WHEN 1 THEN set result = ‘mysql’;<br>    WHEN 2 THEN set result = ‘oracle’;<br>    WHEN 3 THEN set result = ‘sql server’;<br>    ELSE set result = ‘不认识的类型，滚啊。。。’;<br>    END CASE;<br>    select result;<br>end;</p>
<p>call show_database_type(1);</p>
<p>（3）if结构<br>功能：实现多重分类<br>语法：<br>if 条件1 then 语法1;<br>esleif 条件2 then 语法2;<br>…<br>[else 语句n;]<br>end if;</p>
<p>应用场景：应用在begin end中</p>
<p>实战操作：</p>
<h1 id="创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80-显示C，否则显示D-1"><a href="#创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80-显示C，否则显示D-1" class="headerlink" title="创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80,显示C，否则显示D"></a>创建存储过程，根据传入的成绩，来显示登记，比如传入的成绩：90-100显示A，80-90显示B，60-80,显示C，否则显示D</h1><p>create function show_grade(grade int) returns char(1)<br>begin<br>    declare result char(1);<br>    if grade&gt;=90 and grade&lt;=100 THEN set result = ‘A’;<br>    elseif grade&gt;=80 THEN set result = ‘B’;<br>    elseif grade&gt;=60 THEN set result = ‘C’;<br>    else set result = ‘D’;<br>    end if;<br>    return result;<br>end;</p>
<p>select show_grade(55);</p>
<p>#批量插入，根据次数插入到admin表中多条记录，如果次数&gt;20则停止<br>create procedure pro_while_insert2(in count int)<br>begin<br>    declare i int default 1;<br>    a:while i&lt;=count do<br>        insert into admin(username, password) values(CONCAT(‘user’, i), CONCAT(‘psw’, i));<br>        if i&gt;=20 then leave a;<br>        end if;<br>        set i=i+1;<br>    end while a;<br>end;</p>
<p>call pro_while_insert2(30);</p>
<p>10.2.循环结构</p>
<p>循环分类：<br>while、 loop、repeat</p>
<p>循环控制：<br>iterate类似于continue，结束本次循环，继续下一次循环<br>leave类似于break，结束当前所在循环。</p>
<p>三种循环语法：</p>
<p>（1）while<br>[标签:] while 循环条件 do<br>循环体<br>end while [标签]</p>
<p>（2）loop<br>[标签:] loop<br>循环体<br>end loop [标签]</p>
<p>（3）repeat<br>[标签:] repeat<br>循环体<br>until 结束循环的条件<br>end repeat [标签]</p>
<p>循环实战操作：</p>
<p>#批量插入，根据次数插入到amdin表中多条数据<br>create procedure pro_while_insert(in count int)<br>begin<br>    declare i int default 1;<br>    while i&lt;=count do<br>        insert into admin(username, password) values(CONCAT(‘user’, i), CONCAT(‘psw’, i));<br>        set i=i+1;<br>    end while;<br>end;</p>
<p>call pro_while_insert(10);</p>
<p>while VS repeat VS loop<br>while：先判断后执行<br>repeat：先执行后判断<br>loop：没有条件的死循环</p>
<h1 id="博客园所学"><a href="#博客园所学" class="headerlink" title="博客园所学"></a>博客园所学</h1><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引分为单列索引(主键索引,唯一索引,普通索引)和组合索引.<br>单列索引:一个索引只包含一个列,一个表可以有多个单列索引.<br>组合索引:一个组合索引包含两个或两个以上的列。</p>
<h3 id="索引的创建"><a href="#索引的创建" class="headerlink" title="索引的创建"></a>索引的创建</h3><p>1）单列索引</p>
<p>普通索引：<br>第一种方式 :<br>CREATE INDEX 索引名ON 表名(<code>字段名</code>(length))</p>
<p>第二种方式: <br>ALTER TABLE award ADD INDEX account_Index(<code>account</code>)</p>
<p>唯一索引：<br>CREATE UNIQUE INDEX IndexName ON <code>TableName</code>(<code>字段名</code>(length));<br>ALTER TABLE TableName ADD UNIQUE (column_list)</p>
<p>主键索引：不允许有空值</p>
<p>2）组合索引：</p>
<p>语法：<br>CREATE INDEX IndexName On <code>TableName</code>(<code>字段名</code>(length),<code>字段名</code>(length),…);</p>
<h3 id="索引的删除"><a href="#索引的删除" class="headerlink" title="索引的删除"></a>索引的删除</h3><p>语法：<br>DORP INDEX IndexName ON <code>TableName</code></p>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器：监视某种情况，并触发某种操作。</p>
<h3 id="创建语法"><a href="#创建语法" class="headerlink" title="创建语法"></a>创建语法</h3><p>触发器创建语法四要素：1.监视地点(table)<br>　　　　　　　　　　　2.监视事件(insert/update/delete)<br>　　　　　　　　　　 3.触发时间(after/before)<br>　　　　　　　　　　　4.触发事件(insert/update/delete)</p>
<p>语法：<br>create trigger triggerName after/before insert/update/delete<br>on 表名 for each row #这句话是固定的<br> begin<br>     #需要执行的sql语句<br> end<br>注意1:after/before: 只能选一个 ,afte表示后置触发, before表示前置触发<br>注意2:insert/update/delete:只能选一个</p>
<p>创建一个视图：<br>create trigger tag1 after insert on order_table<br>for each row<br>begin<br>    update goods set num=num-3 where id=1;<br>end;</p>
<p>我们如何在触发器引用行的值，也就是说我们要得到我们新插入的订单记录中的gid或much的值。<br>对于insert而言，新插入的行用new来表示，行中的每一列的值用new.列名来表示。<br>所以现在我们可以这样来改我们的触发器:<br>create trigger tg1 after insert on order_table<br>for each row<br>BEGIN<br>    update goods set num = num-new.much where id=new.gid;<br>END;</p>
<p>当用户撤销一个订单的时候，我们这边直接删除一个订单，我们是不是需要把对应的商品数量再加回去呢？<br> 对于delete而言：原本有一行,后来被删除，想引用被删除的这一行，用old来表示旧表中的值，old.列名可以引用原(旧)表中的值。<br>create trigger tg2 after delete on order_table<br>for each ROW<br>BEGIN<br>    update goods set num = num+old.much where id=old.gid;<br>END;</p>
<h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><p>语法：drop trigger 触发器名称;<br>使用：drop trigger dg1;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">那个猪</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/niubilityoyr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;niubilityoyr" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">那个猪</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
